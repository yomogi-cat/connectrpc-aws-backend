# オニオンアーキテクチャによるアプリケーション構造

このプロジェクトはオニオンアーキテクチャパターンを採用しています。これにより、依存関係が内側から外側に向かうように設計され、ドメインロジックとビジネスルールが外部の技術的関心事から分離されています。

## アーキテクチャの概要

```
src/
├── core/              # 内側のレイヤー (ドメインレイヤー)
│   ├── entities/      # ドメインエンティティ
│   └── interfaces/    # インターフェース定義
│       ├── repositories/ # リポジトリインターフェース
│       └── services/  # サービスインターフェース
├── usecase/       # ユースケース（アプリケーションサービス）レイヤー
│   └── services/      # ユースケース実装
├── infrastructure/    # 外側のレイヤー（インフラストラクチャ）
│   ├── logging/       # ロギングの実装
│   ├── persistence/   # データ永続化
│   │   └── repositories/ # リポジトリ実装
│   └── proto/         # 生成されたProtobufコード
├── interfaces/        # インターフェースアダプタ
│   ├── api/           # API関連
│   │   ├── connect.ts # Connectルーティング
│   │   └── handlers/  # API ハンドラー
│   └── server.ts      # サーバー設定
└── config.ts          # アプリケーション設定
```

## レイヤーの詳細説明

### 1. コアレイヤー (src/core)

このレイヤーはドメインモデル、ビジネスルール、およびそれらに関連するインターフェースを含みます。依存関係を持たない最も内側のレイヤーです。

- **entities/**: ドメインエンティティとビジネスロジックを定義します
- **interfaces/**: ドメインサービスやリポジトリのインターフェースを定義します

### 2. アプリケーションレイヤー (src/application)

このレイヤーはユースケースの実装を含み、コアレイヤーのインターフェースに依存します。外部の技術的詳細には依存しません。

- **services/**: コアレイヤーのインターフェースを実装したサービスクラスを含みます

### 3. インフラストラクチャレイヤー (src/infrastructure)

このレイヤーはアプリケーションの技術的実装の詳細を含みます。データベース、外部サービス、フレームワークなどの実装が含まれます。

- **logging/**: ログ記録の実装
- **persistence/**: データの永続化処理（リポジトリパターンの実装）
- **proto/**: Protobuf 生成コード

### 4. インターフェースレイヤー (src/interfaces)

このレイヤーはアプリケーションと外部世界（ユーザー、外部システム）の間のインターフェースを提供します。

- **api/**: API 関連の実装（Connect、ハンドラー）
- **server.ts**: Web サーバーの設定

## 依存関係のルール

1. 内側のレイヤーは外側のレイヤーを知らない（依存しない）
2. 外側のレイヤーは内側のレイヤーに依存する
3. 依存性の方向は常に内側に向かう

## 利点

- **テスト容易性**: ドメインロジックが外部の技術的実装から分離されているため、単体テストが容易
- **保守性**: 実装の詳細が変更されても、ドメインロジックは影響を受けない
- **柔軟性**: 外部の技術（データベース、フレームワークなど）を容易に交換可能

## クリーンアーキテクチャとの関係

オニオンアーキテクチャはクリーンアーキテクチャと多くの共通点を持っています。どちらも依存関係のルールを重視し、ドメインロジックを中心に設計されています。オニオンアーキテクチャは「レイヤー」の概念に焦点を当て、クリーンアーキテクチャは「同心円」のモデルを使用しますが、基本的な原則は同じです。
